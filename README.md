# AI 쇼핑 어시스턴트 설치 및 실행 가이드

## 프로젝트 구조
```
ai-shopping-assistant/
├── app.py                 # 메인 애플리케이션
├── config.py             # 환경 설정
├── utils.py             # 유틸리티 함수 (토큰 관리 등)
├── crawl_products.py     # 상품 크롤링
├── requirements.txt      # 패키지 목록
├── chroma_db/           # 벡터 DB 저장소
├── models/              # 모델 캐시
├── fashion_products.csv # 크롤링 데이터 (크롤러 실행 시)
└── fashion_products.json
```

## 빠른 시작
```bash
# 수동 실행
pip install -r requirements.txt
mkdir -p chroma_db
mkdir -p models
#python crawl_products.py  # (선택) 초기 데이터 네이버 쇼핑 API 크롤링하여 생성
python app.py
```

## 네이버 API 설정
1. https://developers.naver.com 접속
2. 애플리케이션 등록
3. 검색 API 사용 신청
4. config.py에 Client ID/Secret 입력

## 사용 방법
1. http://localhost:7860 접속
2. 상품 이미지 업로드
3. "상품 탐지" 클릭
4. 탐지된 상품 확인
5. 채팅으로 추가 정보 질문

## 주요 기능
- DeepFashion2 기반 패션 아이템 탐지
- CLIP 이미지 특징 추출
- LangChain + ChromaDB RAG 시스템
- Llama 3.2 한국어 모델 대화
- 네이버 쇼핑 API 연동
- 검색 횟수 제한 관리 (10회)
- Gradio 웹 기반 사용자 인터페이스




---

# 실습과제 1: 의류 색상 인식 기능 구현 및 최적화

## 1. 개요 및 문제 정의

본 프로젝트에서는 YOLOv8 모델을 사용하여 이미지 내 패션 아이템을 탐지한다. 하지만 탐지 모델만으로는 아이템의 상세 색상을 파악하기 어렵다는 한계가 있어, 탐지 영역 내에서 주요 색상을 추출하고 이를 한국어 색상명으로 변환하는 기능을 추가 구현하였다.

## 2. 기술적 접근: K-Means 클러스터링

### 2.1 기존 방식의 한계

* **이미지 평균값**: 배경색과 옷 색상이 섞여 원본 이미지와는 무관한 생뚱맞은 색이 도출되는 문제가 있다.
* **최빈값 추출**: 그림자나 반사광으로 인해 미세하게 변화한 RGB 값을 서로 다른 색으로 인식하여 데이터의 대표성이 떨어진다.

### 2.2 K-Means++ 도입 이유

데이터의 유사성을 기준으로 그룹화하는 K-Means 알고리즘을 도입하여 위 한계점들을 보완하였다. 특히 초기 중심점을 무작위로 찍는 대신, 점들 간의 거리를 계산하여 전략적으로 배치하는 **K-Means++** 전략을 선택했다. 이를 통해 군집화의 안정성을 높이고 전체 계산 시간(반복 횟수)을 단축할 수 있었다.

---

## 3. 트러블 슈팅: RGB에서 HSV 색 공간으로의 전환

### 3.1 문제 상황 (RGB의 한계)

초기 RGB 색 공간 기반 구현 시, 조명과 그림자의 영향으로 색상 오인식이 발생했다.

* 연보라색 의류 → 핑크색으로 분류
* 빨간색 니트 → 갈색 니트로 분류

### 3.2 해결 근거 (HSV의 이점)

RGB 공간은 빛의 밝기에 따라  수치가 동시에 변하기 때문에 그림자에 매우 취약하다. 반면 **HSV(Hue, Saturation, Value)** 색 공간은 색상()과 밝기()가 분리되어 있다.

* **색상 본질 유지**: 그림자가 져서 밝기가 변하더라도 실제 색상() 값은 비교적 일정하게 유지된다.
* **인지적 거리**: 사람이 인식하는 방식과 유사하여 K-Means가 '색의 본질'을 기준으로 픽셀들을 정확히 묶어낼 수 있는 환경을 제공한다.

---

## 4. 상세 구현 로직 (app.py)

* **색상 팔레트 확장**: 연보라, 진분홍, 하늘색 등을 추가한 **19가지 색상 범위**를 HSV 기준으로 정의하여 판별력을 높였다.
* **노이즈 및 배경 필터링**:
* 채도()가 30 이하인 픽셀은 무채색(검정, 회색, 흰색)으로 별도 판별한다.
* 너무 밝거나 어두운 픽셀(반사광, 그림자)을 분석 대상에서 제외하여 옷 고유의 색상에만 집중하도록 설계했다.


* **클러스터 수 최적화**: 군집(K)의 수를 5개에서 **3개**로 조정하여 주요 색상 추출의 선명도를 확보했다.

## 5. 결과 및 기대 효과

HSV 기반 K-Means++ 알고리즘을 적용한 결과, 조명 변화가 있는 실사용 환경에서도 의류의 대표 색상을 안정적으로 추출할 수 있게 되었다. 이렇게 추출된 색상 정보는 상품 검색 키워드에 포함되어 추천 시스템의 신뢰도를 향상시킨다.

---

## 🔗 관련 포스팅 및 상세 과정

알고리즘의 개념 및 트러블 슈팅에 대한 더 자세한 내용은 아래 블로그 포스팅에서 확인할 수 있다.

* [K-Means 클러스터링을 활용한 색상 인식 원리](https://attention-is-all-i-need.tistory.com/14)
* [트러블 슈팅: RGB에서 HSV 전환을 통한 정확도 개선 과정](https://attention-is-all-i-need.tistory.com/15)

---
